# Sentinel-2 Refugee Camp Detection - Configuration
# ================================================

# Sentinel-2 bands to download (raw)
bands:
  - B02  # Blue (10m)
  - B03  # Green (10m)
  - B04  # Red (10m)
  - B08  # NIR (10m)
  - B11  # SWIR1 (20m, resampled to 10m)
  - B12  # SWIR2 (20m, resampled to 10m)

# Model input channels: RGB + NDVI + NDBI + SWIR_ratio = 6
# Derived from raw bands, NOT raw bands directly
input_channels:
  - R      # B04
  - G      # B03
  - B      # B02
  - NDVI   # (B08 - B04) / (B08 + B04)
  - NDBI   # (B11 - B08) / (B11 + B08)
  - SWIR_ratio  # B12 / B11

# Tile parameters
tile_size_download: 128    # pixels per side at download (1.28 km at 10m)
tile_size_model: 64        # resize to this for the CNN
resolution: 10             # meters per pixel

# Multi-tile grid per camp location
grid:
  size: 3                  # 3x3 grid around each camp center
  # Label strategy: since we have POINTS not polygons, we use a buffer
  # Center tile (0,0) = "camp" (high confidence, point is here)
  # Adjacent tiles (dist=1) = "camp" (within 1.28km, likely partial coverage)
  # Corner tiles (dist=2) = EXCLUDED by default (too far, likely noise)
  #
  # Why exclude corners:
  # - Tile covers 1.28km, camp point buffer is 500m
  # - Corner centers are ~1.81km from camp point (sqrt(2) * 1.28)
  # - At that distance, <10% of a typical camp falls in the corner tile
  # - Including them adds noise > signal
  #
  # If polygons become available, switch to polygon intersection
  label_strategy: point_buffer  # "point_buffer" or "polygon"
  buffer_m: 500                 # buffer around camp point for labeling
  include_corners: false        # if false, corners are excluded from training
  # With include_corners=false: 5 tiles per camp (center + 4 adjacent)
  # With include_corners=true:  9 tiles per camp (full 3x3, corners weight 0.5)

# Sentinel-2 search parameters
cloud_threshold: 20        # max cloud cover percentage
date_range:
  - "2022-01-01"
  - "2023-12-31"

# Geographic split
train_countries:
  - syria
  - south_sudan
test_countries:
  - chad
  - ethiopia
  - yemen

# -------------------------------------------------------------------
# Class definitions (for paper clarity)
# -------------------------------------------------------------------
# camp: Location recognized by UNHCR as refugee/IDP camp OR tagged
#        in OpenStreetMap as place=camp / refugee=yes / camp:type=refugee.
#        These are KNOWN displacement sites with official or community
#        documentation.
#
# informal: High-density self-built urban areas NOT labeled as refugee
#           camps. Used as hard negatives to prevent the model from
#           learning "dense = camp". Includes peri-urban slums and
#           unplanned neighborhoods.
# -------------------------------------------------------------------

# Negative sample generation
negative_buffer_km: 10     # min distance from any camp
negative_ratio: 3          # negatives PER CAMP (not per tile) per category
negative_categories:        # explicit negative types
  - rural                  # dispersed rural areas
  - urban                  # formal dense cities
  - barren                 # desert / bare soil / savanna
  - informal               # informal settlements NOT refugee camps (hard negatives)
# Total negatives = n_camps * negative_ratio * len(negative_categories)
# Example: 50 camps * 3 * 4 = 600 negatives

# Model
model:
  backbone: resnet18
  pretrained: true
  in_channels: 6           # RGB + NDVI + NDBI + SWIR_ratio
  num_classes: 1           # binary (sigmoid output)
  freeze_epochs: 5         # freeze backbone for N epochs
  lr: 0.0001
  batch_size: 32           # use 16 if training at 128px
  max_epochs: 50
  patience: 5              # early stopping patience
  pos_weight: 3.0          # BCEWithLogitsLoss weight for positives
  context_weight: 0.5      # reduced loss weight for camp_context tiles (if corners included)

# Augmentation
augmentation:
  random_rotation: true    # 90/180/270 degrees
  horizontal_flip: true
  vertical_flip: true
  brightness_jitter: 0.1   # +/- 10% brightness

# Normalization
normalization:
  method: percentile
  low: 2                   # 2nd percentile
  high: 98                 # 98th percentile

# Inference
inference:
  confidence_threshold: 0.8  # for candidate detections
  top_k: 50                  # Precision@Top-K evaluation

# Data leakage prevention
split:
  by_scene: true             # never mix tiles from same Sentinel-2 scene
  val_fraction: 0.2

# Mini-test mode: download only N camps first for visual validation
mini_test:
  enabled: true              # set false for full pipeline
  n_camps: 10               # number of camps to download first
